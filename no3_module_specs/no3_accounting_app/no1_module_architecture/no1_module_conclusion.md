# 核心功能原則

- **資料流原則**
    - **核心:** 本地優先 Local-First
    - **流程:**
        - 使用者操作
        - 立即寫入 本機 DB
        - 觸發 App 狀態更新
        - UI 立即重新渲染
- **多幣別原則**
    - **核心:** 基礎貨幣
    - **理由:** 報表需要一個統一的計算基準
    - **流程:**
        - 使用者可設定 基礎貨幣
        - 所有非基礎貨幣的資產, 在顯示於多幣別報表時, **必須** 換算為基礎貨幣價值
- **匯率原則**
    - **核心:** 使用者手動維護匯率
    - **理由:**
        - 避免外部 API 費用且無法估算
        - 匯率短期變化不大, 使用現行匯率計算仍有高度參考價值
        - 使用者可能是私下匯兌
    - **流程:**
        - 報表換算時, 不回溯 資產當時價格
        - 不使用外部 API 獲取匯率
        - 換匯交易時, App 不限制 使用者當下輸入的匯率
- **報表原則**
    - **核心:** 依時區計算, 依現行匯率換算
    - **理由:** 確保 今天 的定義符合使用者時區, 並統一報表基準
    - **流程:**
       - 使用者可設定 主要時區
       - 所有報表的時間邊界, **必須** 基於使用者設定的 主要時區 進行計算
- **認證與同步原則**
    - **核心:** 本地優先, 雲端備份
    - **理由:** 確保 App 可 100% 離線運作, 登入僅為綁定帳號, 同步為付費增值服務
    - **流程:**
        - 採納 情境式登入 (Contextual Login), 僅在需權限操作時要求登入
        - 免費版: 資料僅儲存於本機
        - 付費版: 啟用 增量批次同步, 將本機資料備份至雲端, 並允許跨裝置同步
- **自動化原則**
    - **核心:** 本機觸發
    - **理由:** 確保 App 在離線狀態下也能自動產生應收應付項目
    - **流程:**
        - App 啟動時, **必須** 檢查本地的 `Schedules` 表
        - **必須** 補產生從上次檢查到 今天 所有遺漏的交易
- **啟動流程原則**
    - **核心:** 依序執行
    - **理由:** 確保資料一致性, 避免同步衝突
    - **流程:**
        - App 啟動時, **必須** 優先執行 定期交易 的補產生
        - 完成後, 才可執行 批次同步 的自動觸發