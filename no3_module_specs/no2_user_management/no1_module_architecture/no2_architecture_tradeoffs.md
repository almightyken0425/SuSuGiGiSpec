# 設計決策權衡, Trade-offs

- **Firestore 讀寫成本 vs 使用者體驗**
    - **決策:** 選擇即時寫入以確保體驗
    - **權衡:** 接受較高的寫入次數 Cost，換取使用者在多裝置間無縫切換的體驗 UX。
    - **緩解:** 偏好設定變更頻率極低，實際成本影響有限。

- **Server-Side 訂閱管理 vs Client-Side**
    - **決策:** 選擇 Server-Side 如 RevenueCat
    - **權衡:** 犧牲一點即時性如 Webhook 延遲，換取安全性與準確性。
    - **理由:** 避免 Client 端被破解或竄改訂閱狀態，且 RevenueCat 能處理複雜的跨平台訂閱邏輯。

- **Firebase/RevenueCat vs 自建 Server**
    - **決策:** 選擇 Firebase Auth/DB 與 RevenueCat 託管
    - **權衡:** 犧牲部分資料庫結構的彈性如 NoSQL 限制，與對底層的完全控制權。
    - **理由:** 大幅降低維運成本 Ops Cost 與開發複雜度，讓團隊能專注於 App 核心功能開發。

- **強制早登入 Early Login vs 情境式登入 Contextual Login**
    - **決策:** 採納 **情境式登入 Contextual Login**
    - **權衡:** 犧牲早期使用者資料歸戶的完整性，換取更低的進入門檻與更好的首日留存率 Retention。
    - **理由:** 強制登入就像 走進店家連東西都還沒看就要求辦會員 ，體驗極差。應在 結帳櫃台 例如付費或備份時才詢問會員意願。

- **主動登出 Explicit Logout vs 永久登入**
    - **決策:** **保留主動登出按鈕**
    - **權衡:** 提供切換帳號的彈性，但需處理本地資料與不同帳號間的隔離問題。
    - **理由:** 使用者可能有更換帳號的需求，且明確的登出選項能提供安全感。

- **Cloud Function API vs 直接寫入本地 DB Local-First**
    - **決策:** 採納 **直接寫入本地 DB**
    - **權衡:** 犧牲部分後端驗證能力，換取極致的即時性與離線支援。
    - **理由:** 偏好設定邏輯簡單，且 Sync Engine 已負責權限驗證。直接寫入本地 DB 可確保 UI 零延遲更新，且完全支援離線操作。

- **安全性風險權衡 Security Trade-offs**
    - **Client-Side 權限檢查 vs Server-Side 嚴格驗證**
        - **決策:** 接受針對非關鍵資料的 **Client-Side 繞過風險**
        - **權衡:** 接受極少數駭客修改 App 繞過付費牆，換取離線使用的便利性與架構簡單性。
        - **理由:** 記帳 App 的核心價值在於資料輸入與報表，非伺服器端獨有資源。防堵成本 > 潛在損失。
    - **離線過期檢查 vs 永久離線使用**
        - **決策:** 實作 **離線過期檢查 TTL**
        - **權衡:** 需在本地儲存過期日，並在離線時進行檢查。
        - **理由:** 防止使用者訂閱後長期離線以規避續費檢查。
    - **帳號共用 vs 嚴格裝置限制**
        - **決策:** **忽略帳號共用風險**
        - **權衡:** 不實作裝置數量限制。
        - **理由:** 記帳資料具高度隱私性，共用帳號意願低，且對營收衝擊有限。
