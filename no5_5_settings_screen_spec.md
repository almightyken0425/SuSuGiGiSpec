# 設定主頁 (SettingsScreen)

_(本文件定義「設定」主畫面的 UI、流程與邏輯)_

## 畫面目標 (Screen Objective)

- 提供一個中心化的入口，讓使用者可以存取所有與帳戶、資料和偏好設定相關的功能。
- 提供登出和升級至付費版的路徑。

## UI 佈局與元件 (UI Layout & Components)

- **頂部導航列 (Top Navigation Bar):**
    - **左側:** 「返回」或「關閉」按鈕，將使用者導航回首頁 (`HomeScreen`)。
    - **中間:** 畫面標題，顯示「設定」。

- **設定列表 (Settings List):**
    - **UI:** 一個分組列表 (`SectionList`)，將相關的設定項目組織在一起。
    - **項目:**
        - **資料管理 (Data Management)**
            - **類別管理:**
                - **入口 UI:** 包含圖示和「類別管理」文字。
                - **流程:**
                    - **導航至類別列表畫面 (`CategoryListScreen`):**
                        - **UI:** 以「支出」和「收入」兩個堆疊區塊顯示，新增按鈕位於各區塊的標題列。
                        - **互動:** 在各自的區塊內支援拖拉排序，更新 `sortOrder` 欄位。
                    - **導航至類別編輯器畫面 (`CategoryEditorScreen`):**
                        - **觸發:** 點擊列表中的現有類別，或點擊「新增」按鈕。
                        - **UI:** 提供名稱、圖示選擇、標準類別映射等欄位。
                        - **邏輯:** 處理新增/編輯/刪除，並檢查免費版 10 個類別的限制。
            - **帳戶管理:**
                - **入口 UI:** 包含圖示和「帳戶管理」文字。
                - **流程:**
                    - **導航至帳戶列表畫面 (`AccountListScreen`):**
                        - **UI:** 顯示所有帳戶列表，並可拖拉排序。
                        - **互動:** 支援拖拉排序。
                    - **導航至帳戶編輯器畫面 (`AccountEditorScreen`):**
                        - **觸發:** 點擊列表中的現有帳戶，或點擊「新增」按鈕。
                        - **UI:** 提供名稱、圖示、幣別、初始餘額等欄位。
                        - **邏輯:** 處理新增/編輯/刪除，並檢查免費版帳戶數量的限制。
            - **匯率管理:**
                - **UI:** 包含圖示和「匯率管理」文字，並在右側顯示一個 "Premium" 標籤。
                - **導航:** 點擊後導航至匯率管理畫面 (`CurrencyRateScreen`)，用於管理各貨幣對的最新有效匯率。

            - **匯入資料:**
                - **UI:** 包含圖示和「匯入資料」文字，並在右側顯示一個 "Premium" 標籤。
                - **導航:** 點擊後需檢查 `isPremiumUser` 狀態，若為免費版則直接導向 `PaywallScreen`，若為付費版才導航至 `ImportScreen`。

        - **偏好設定 (Preferences)**
            - **偏好設定:**
                - **UI:** 包含圖示和「偏好設定」文字。
                - **導航:** 點擊後導航至偏好設定畫面 (`PreferenceScreen`)，用於設定基礎貨幣、時區、語系，並提供清除資料等進階選項。

        - **升級 (Upgrade)**
            - **升級至 Premium:**
                - **UI:** 一個醒目的項目，包含圖示和「升級至 Premium」文字。
                - **邏輯:** 此項目**僅對免費版使用者顯示**。
                - **導航:** 點擊後導航至付費牆畫面 (`PaywallScreen`)。

        - **帳號 (Account)**
            - **登出:**
                - **UI:** 紅色的「登出」文字按鈕。
                - **邏輯:** 點擊後觸發登出流程。

## 核心邏輯

- **付費功能處理 (Premium Feature Handling):**
    - 畫面載入時，從「**本機狀態 (e.g., PremiumContext)**」讀取 `isPremiumUser` 狀態。
    - **「匯率管理」項目:** 對於免費版使用者，雖然此項目可見，但在點擊導航至 `CurrencyRateScreen` 之前，應先檢查「**本機狀態**」中的 `isPremiumUser`，若為免費版則直接導向「付費牆畫面 (`PaywallScreen`)」。
    - **「升級至 Premium」項目:** 根據 `isPremiumUser` 狀態動態顯示或隱藏。

- **登出邏輯 (Logout Logic):**
    - 點擊「登出」按鈕時，彈出一個確認對話框（例如：「您確定要登出嗎？」）。
    - 使用者確認後，呼叫 `authService.signOut()`。
    - `AuthContext` 應監聽認證狀態的變化。當偵測到使用者已登出時，`AppNavigator` 會自動將畫面切換回 `LoginScreen`。

## 導航 (Navigation)

- **進入:** 從首頁 (`HomeScreen`) 的頂部導航列點擊「設定」圖示進入。
- **退出:** 點擊頂部導航列的「返回/關閉」按鈕，返回首頁 (`HomeScreen`)。
