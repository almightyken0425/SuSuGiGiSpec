# 付費牆畫面: PaywallScreen

## 畫面目標

- **傳達:** Premium 版本的雙重價值
    - 功能解鎖
    - 雲端同步
- **提供:** 無摩擦的介面引導使用者完成訂閱
- **處理:** 購買與恢復購買的邏輯

---

## 觸發情境

- **主動觸發:**
    - **來源:** 點擊設定主頁上的升級至 Premium 按鈕
- **被動觸發:**
    - **來源:** 嘗試存取任何付費功能時
    - **說明:** 由各功能畫面自行檢查 `PremiumLogic.checkPremiumStatus()` 狀態並呼叫此畫面

---

```text
+--------------------------------+
| X                              |
|                                |
|   Unlock Full Potential        |
|                                |
| [Icon] Cloud Backup            |
| [Icon] Unlimited Accounts      |
| [Icon] Multi-Currency          |
|                                |
| [ ] Yearly $XX / yr (Best)     |
| [ ] Monthly $XX / mo           |
|                                |
| [ Start 7-Day Free Trial ]     |
|                                |
| Restore | Terms | Privacy      |
+--------------------------------+
```

---

## UI 佈局

- `關閉按鈕`
- **主要價值主張:**
    - `標題` 解鎖速速記記的完整潛力
    - `副標題` 解鎖無限功能，並啟用安全的雲端備份
- **功能列表:**
    - **雲端與備份:**
        - 每日雲端備份：資料自動備份，手機遺失也不怕
        - 跨裝置同步：在您的所有裝置上同步資料
    - **核心功能:**
        - 無限帳戶：建立不限數量的帳戶
        - 無限類別：建立不限數量的類別
    - **進階理財:**
        - 多幣別支援：管理您的外幣資產與匯率
        - 定期交易：自動建立您的週期性收支
    - **資料工具:**
        - 資料匯入：從 CSV 檔案快速遷移您的歷史紀錄
- **訂閱選項區:**
    - **年度方案:**
        - **標籤:** 推薦
        - **價格:** 動態顯示 RevenueCat 取回的年度價格
        - **折扣:** 動態計算並顯示月均價
    - **月度方案:**
        - **價格:** 動態顯示 RevenueCat 取回的月度價格
- `行動呼籲按鈕`
    - **文字:** 升級並開始 7 天免費試用
- **頁腳連結:**
    - `恢復購買`
    - `服務條款`
    - `隱私權政策`

---

## 核心邏輯

- **串接服務:**
    - **要求:** 串接跨平台購買服務
    - **範例:** RevenueCat
- **動態價格載入:**
    - **觸發:** 畫面載入
    - **呼叫:** `RevenueCat.getOfferings`
    - **禁止:** 在 App 內寫死價格
    - **顯示:** 從 RevenueCat 取回本地化價格字串
- **購買邏輯:**
    - **觸發:** 使用者選擇方案並點擊 CTA
    - **前置檢查採用 Redirect Flow:**
        - **檢查:** `AuthContext.isAnonymous` 確認是否為訪客
        - **IF True 若為訪客:**
            - **行為:** 關閉 Paywall Modal
            - **導航:** `LoginScreen`，並帶入參數 `{ redirect: 'PaywallScreen' }`
            - **目的:** 確保購買歸戶至正式帳號，避免匿名購買遺失
    - **執行購買若已登入:**
        - **呼叫:** `RevenueCat.purchasePackage`
    - **成功後:**
        - **更新:** 呼叫 `PremiumLogic.refreshPremiumStatus()` 更新權限
        - **提示:** 升級成功
        - **導航:** 自動關閉 PaywallScreen
    - **失敗後:**
        - **提示:** 購買失敗或已取消
- **恢復購買邏輯:**
    - **觸發:** 點擊恢復購買連結
    - **呼叫:** `RevenueCat.restorePurchases`
    - **成功後:**
        - **更新:** 呼叫 `PremiumLogic.refreshPremiumStatus()` 更新權限
        - **提示:** 恢復成功
        - **導航:** 自動關閉 PaywallScreen
    - **失敗後:**
        - **提示:** 找不到您的購買紀錄

---

## 導航

- **進入:**
    - **方式:** Modal
    - **來源:** 多個觸發情境 參見觸發情境段落
- **退出:**
    - **觸發:** 點擊關閉按鈕或購買/恢復成功
    - **導航:** 關閉 Modal