# 輸入欄位字數限制策略

## 核心原則

採用「寬鬆上限 + UI 智慧截斷」策略:

- **資料庫層**: 設定理論上不會碰到的上限,防止惡意攻擊和資料庫異常
- **UI 顯示層**: 透過截斷、省略、多行顯示等方式處理長文本
- **使用者體驗**: 不主動限制或提示字數,僅在提交時驗證

---

## 各欄位字數上限

### 名稱類欄位

| 欄位 | 上限 | 資料庫類型 | 說明 |
|------|------|-----------|------|
| 帳戶名稱 | 255 | VARCHAR(255) | 標準名稱長度,足夠應對各種情境 |
| 類別名稱 | 255 | VARCHAR(255) | 同上 |
| 標籤名稱 | 100 | VARCHAR(100) | 標籤通常較簡短 |
| 週期交易名稱 | 255 | VARCHAR(255) | 需描述週期性質 |

### 描述類欄位

| 欄位 | 上限 | 資料庫類型 | 說明 |
|------|------|-----------|------|
| 交易備註 | 1000 | VARCHAR(1000) | 允許較詳細的交易說明 |
| 帳戶描述 | 500 | VARCHAR(500) | 選填說明欄位 |
| 類別說明 | 500 | VARCHAR(500) | 選填說明欄位 |

### 固定長度欄位

| 欄位 | 長度 | 資料庫類型 | 說明 |
|------|------|-----------|------|
| 貨幣代碼 | 3 | CHAR(3) | ISO 4217 標準 |
| 圖示代碼 | 50 | VARCHAR(50) | 依圖示庫而定 |

---

## UI 顯示策略

### 列表頁面 (List Views)

- **原則:** 單行顯示,超出部分以省略號處理
- **目的:** 保持列表整潔,避免破版

**範例實作:**
```jsx
<Text numberOfLines={1} ellipsizeMode="tail">
  {item.note || '無備註'}
</Text>
```

**規格描述範本:**
```markdown
- `備註顯示`
    - **內容:** 顯示交易備註
    - **樣式:** 單行,超出部分以省略號顯示
    - **IF 無備註:**
        - **顯示:** 不顯示此欄位
```

### 詳情頁面 (Detail Views)

- **原則:** 完整顯示,自動換行
- **目的:** 讓使用者查看完整內容

**範例實作:**
```jsx
<Text>{item.note}</Text>
```

**規格描述範本:**
```markdown
- `備註文字`
    - **顯示:** 多行完整顯示
    - **樣式:** 自動換行
```

### 編輯頁面 (Editor Views)

- **原則:** 多行輸入,僅設定最大長度
- **目的:** 允許自由輸入,不干擾體驗

**範例實作:**
```jsx
<TextInput
  multiline
  maxLength={1000}
  placeholder="新增備註"
  value={note}
  onChangeText={setNote}
/>
```

**規格描述範本:**
```markdown
- `備註輸入框`
    - **類型:** 多行文字輸入
    - **佔位符:** 新增備註
    - **限制:** 最多 1000 字元
    - **顯示:** 不顯示字數計數器
    - **驗證:** 僅在提交時檢查長度
```

---

## 驗證與錯誤處理

### 驗證時機

- **前端:** TextInput maxLength 硬限制
- **提交時:** 表單驗證檢查
- **後端:** API 接收時驗證
- **資料庫:** 欄位約束最終防線

### 錯誤訊息

**IF 超過字數上限:**
```markdown
- **行為:** 顯示錯誤訊息,禁止提交
- **訊息:** "{欄位名稱}不可超過 {上限} 字元,目前 {實際字數} 字元"
- **樣式:** 紅色錯誤文字
- **操作:** Focus 回該輸入框
```

**範例錯誤訊息:**
- "備註不可超過 1000 字元,目前 1023 字元"
- "帳戶名稱不可超過 255 字元,目前 267 字元"

---

## 規格文件標準描述

### 資料模型定義

```markdown
### Transactions 交易記錄

- **note** (VARCHAR(1000), 選填)
    - **說明:** 交易備註
    - **預設:** NULL
```

### 畫面 UI 佈局

#### 列表顯示
```markdown
- **交易列表:**
    - `備註`
        - **顯示:** 單行,超出以省略號顯示
        - **IF 無備註:** 不顯示
```

#### 編輯輸入
```markdown
- `備註輸入框`
    - **類型:** 多行文字輸入
    - **佔位符:** 新增備註
    - **限制:** 最多 1000 字元
    - **驗證:** 提交時檢查
```

### 核心邏輯

```markdown
- **表單驗證:**
    - **觸發:** 提交按鈕點擊
    - **IF 備註超過 1000 字元:**
        - **行為:** 顯示錯誤訊息
        - **訊息:** 備註不可超過 1000 字元
        - **操作:** 禁止提交
```

---

## 特殊考量

### 字元計算

- **統一使用字元數** (Character count),非字數 (Word count)
- **包含所有字元**: 中文、英文、數字、符號、空白、Emoji
- **Emoji 處理**: 某些 emoji 可能佔多個字元,需測試

### 空白處理

- **顯示時**: 保留使用者輸入的空白
- **儲存前**: Trim 前後空白
- **驗證時**: 以 trim 後的長度為準

### 國際化

- 255 字元約可容納:
  - 255 個英文字母
  - 127 個中文字
  - 混合使用時依實際佔用計算

---

## 實作檢查清單

開發時需確保:

- 資料庫欄位設定正確的 VARCHAR 長度
- TextInput 設定 maxLength 屬性
- 列表頁使用 numberOfLines={1} 和 ellipsizeMode="tail"
- 詳情頁完整顯示文字
- 編輯頁使用 multiline TextInput
- 表單提交前驗證長度
- 後端 API 驗證輸入長度
- 錯誤訊息清晰明確
- 測試 Emoji 和特殊字元

---

## 範例:交易備註欄位完整流程

### 1. 資料模型
```markdown
- **note** (VARCHAR(1000), 選填)
```

### 2. 列表頁顯示
```markdown
- `備註文字`
    - **樣式:** 單行,超出以...顯示
```

### 3. 詳情頁顯示
```markdown
- `備註文字`
    - **樣式:** 多行完整顯示
```

### 4. 編輯頁輸入
```markdown
- `備註輸入框`
    - **類型:** 多行文字
    - **限制:** 最多 1000 字元
```

### 5. 驗證邏輯
```markdown
- **表單驗證:**
    - **IF note.length > 1000:**
        - **錯誤:** 備註不可超過 1000 字元
```

---

## 文件結束
