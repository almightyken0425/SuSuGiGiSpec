# 類別列表規格: CategoryListScreen

## 畫面目標

- **提供:** 查看, 排序, 管理 所有自訂 收入 與 支出 類別的介面
- **作為:** 新增, 編輯, 刪除 特定類別的入口

## UI 佈局

- **頂部導航列:**
    - **內部元件:**
        - **返回按鈕**
            - **導航:** SettingsScreen
        - **標題**
            - **內容:** 類別管理
- **頁面主體:**
    - **UI:** 列表
    - **內部結構:**
        - **支出區**
        - **收入區**
- **支出區:**
    - **區塊標題:**
        - **內部元件:**
            - **標題**
                - **內容:** 支出
            - **新增按鈕**
                - **觸發:** 付費牆檢查
                - **導航:** CategoryEditorScreen
                - **參數:** categoryType: 支出
    - **類別列表:**
        - **UI:** DraggableFlatList
        - **空狀態:** 顯示 您尚未建立任何支出類別
        - **項目內容:**
            - **內部元件:**
                - **圖示**
                - **名稱**
                - **拖拉圖示**
            - **視覺標示 - 停用:**
                - **條件:** `disabledOn` 非 null
                - **UI:** 灰色文字 或 已停用 標籤
- **收入區:**
    - **區塊標題:**
        - **內部元件:**
            - **標題**
                - **內容:** 收入
            - **新增按鈕**
                - **觸發:** 付費牆檢查
                - **導航:** CategoryEditorScreen
                - **參數:** categoryType: 收入
    - **類別列表:**
        - **UI:** DraggableFlatList
        - **空狀態:** 顯示 您尚未建立任何收入類別
        - **項目內容:**
            - **內部元件:**
                - **圖示**
                - **名稱**
                - **拖拉圖示**
            - **視覺標示 - 停用:**
                - **條件:** `disabledOn` 非 null
                - **UI:** 灰色文字 或 已停用 標籤

## 核心邏輯

- **資料載入:**
    - **觸發:** 畫面載入
    - **來源:** 本機 DB
    - **查詢:** 所有 `Categories`
    - **過濾:** `deletedOn` 為 null
    - **分組:** 依 `categoryType` 篩選為 支出, 收入 兩個陣列
    - **排序:** 依 `sortOrder` 初始排序
- **互動邏輯:**
    - **點擊項目:**
        - **導航:** CategoryEditorScreen
        - **模式:** 編輯
        - **參數:** categoryId
    - **拖拉排序:**
        - **限制:** 僅限在各自區塊內
        - **行為:** 更新受影響類別的 `sortOrder`
        - **儲存:** 寫入 本機 DB
        - **欄位:** 必須更新所有受影響類別的 `updatedOn`
- **付費牆檢查:**
    - **觸發:** 點擊任一 新增按鈕
    - **檢查:**
        - `PremiumContext.isPremiumUser` 狀態
        - 本機 DB 自訂類別總數
    - **IF** 免費版 AND 類別數量已達上限:
        - **導航:** PaywallScreen
    - **ELSE:**
        - **導航:** CategoryEditorScreen

## 狀態管理

- **本地狀態:**
    - `expenseCategories`
    - `incomeCategories`

## 導航

- **進入:**
    - **來源:** SettingsScreen
- **退出:**
    - **來源:** 頂部導航列 返回按鈕
- **導出:**
    - **來源:** 點擊列表項目 或 新增按鈕
    - **導航:** CategoryEditorScreen
    - **導出 付費牆:**
        - **來源:** 點擊 新增按鈕
        - **導航:** PaywallScreen