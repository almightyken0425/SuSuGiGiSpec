# 帳戶編輯器規格: AccountEditorScreen

## 畫面目標

- **提供:** 新增 或 編輯 帳戶 的統一介面
- **處理:** 新增外幣帳戶時的匯率輸入流程

## UI 佈局

- **呈現方式:** Modal 形式從底部彈出
- **頂部導航列:**
    - **內部元件:**
        - **關閉按鈕**
        - **標題**
            - **內容:** 依模式顯示 新增帳戶, 編輯帳戶
        - **儲存按鈕**
            - **可見性:** 僅所有必填欄位有效時才可點擊
- **核心欄位區:**
    - **帳戶名稱:**
        - **UI:** 文字輸入框, TextInput
        - **屬性:** 必填項
    - **圖示:**
        - **UI:** 顯示當前所選圖示的區域
        - **導航:** IconPickerScreen
        - **屬性:** 必填項
    - **幣別:**
        - **UI:** 選擇器
        - **行為:** 點擊彈出 Currency.json 列表
        - **邏輯:** 編輯模式下, 此欄位不可修改
        - **屬性:** 必填項
    - **初始餘額:**
        - **UI:** 金額輸入框
        - **可見性:** 僅 新增模式 顯示
    - **標準帳戶類型:**
        - **UI:** 選擇器
        - **行為:** 點擊彈出 StandardAccountType.json 列表
- **停用開關區:**
    - **UI:** Switch 元件
    - **標題:** 停用此帳戶
    - **可見性:** 僅 編輯模式 顯示
    - **邏輯:** 讀取 `disabledOn` 欄位狀態決定開關預設值
- **刪除按鈕區:**
    - **UI:** 紅色 刪除此帳戶 按鈕
    - **可見性:** 僅 編輯模式 顯示

## 核心邏輯

- **模式判斷:**
    - **觸發:** 畫面載入
    - **檢查:** 導航參數 `accountId`
    - **IF** 有 `accountId` 編輯模式:
        - **行為:** 從 本機 DB 讀取帳戶資料填入表單
    - **IF** 無 `accountId` 新增模式:
        - **行為:** 準備一個空的表單
- **儲存邏輯:**
    - **觸發:** 點擊 儲存按鈕
    - **新增模式:**
        - **付費牆檢查 - 數量:**
            - **檢查:**
                - `PremiumContext.isPremiumUser` 狀態
                - 本機 DB 帳戶數量
            - **IF** 免費版 AND 帳戶数量已達上限:
                - **導航:** PaywallScreen
        - **付費牆檢查 - 多幣別:**
            - **條件:** 使用者選擇了非基礎貨幣
            - **檢查:** `PremiumContext.isPremiumUser` 狀態
            - **IF** False 免費版:
                - **導航:** PaywallScreen
        - **匯率輸入流程 - 多幣別:**
            - **條件:**
                - `isPremiumUser` 為 True
                - 選擇了非基礎貨幣
            - **行為:**
                - 彈出介面提示使用者輸入初始匯率
                - 此匯率輸入為必填項
        - **儲存操作:**
            - **IF** 涉及匯率輸入:
                - **行為:** 批次操作, 於 本機 DB 新增 `CurrencyRates` 和 `Account`
                - **欄位:** 兩者都必須設定 `updatedOn`
            - **ELSE:**
                - **行為:** 於 本機 DB 建立新 `Account` 記錄
                - **欄位:** 必須設定 `updatedOn`
    - **編輯模式:**
        - **行為:**
            - 組合表單資料
            - **IF** 停用開關 開啟:
                - **欄位:** `disabledOn` 設為當前時間戳記
            - **IF** 停用開關 關閉:
                - **欄位:** `disabledOn` 設為 null
        - **儲存:** 更新 本機 DB 該筆記錄
        - **欄位:** 必須更新 `updatedOn`
    - **成功:**
        - **導航:** 關閉畫面, 返回 AccountListScreen
- **刪除邏輯:**
    - **觸發:** 點擊 刪除按鈕
    - **行為:** 顯示確認對話框
    - **成功:**
        - **行為:** 軟刪除 本機 DB 該筆 `Account`
        - **欄位:** 必須設定 `deletedOn` 並更新 `updatedOn`
        - **導航:** 關閉畫面, 返回 AccountListScreen

## 狀態管理

- **本地狀態:**
    - `name`
    - `iconId`
    - `currencyId`
    - `initialBalanceCents`
    - `standardAccountTypeId`
    - `isDisabled`

## 導航

- **進入:**
    - **來源:** AccountListScreen
- **退出:**
    - **觸發:** 點擊 關閉按鈕, 或 儲存/刪除 成功
    - **行為:** `navigation.goBack()`