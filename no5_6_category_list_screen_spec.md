# 設定 - 類別列表 (CategoryListScreen)

_(本文件定義「類別管理」列表畫面的 UI、流程與邏輯)_

## 畫面目標 (Screen Objective)

- 提供一個讓使用者可以**查看**、**排序**和**管理**所有自訂「收入」與「支出」類別的介面。
- 作為新增、編輯或刪除特定類別的入口。

## UI 佈局與元件 (UI Layout & Components)

- **頂部導航列 (Top Navigation Bar):**
    - **左側:** 「返回」按鈕，導航回設定主頁 (`SettingsScreen`)。
    - **中間:** 畫面標題，顯示「類別管理」。
    - **右側:** (留白)。

- **頁面主體 (Body):**
    - **類別分區標題 (Category Section Headers):**
        - **UI:** 在每個類別列表（支出、收入）的頂部，應有一個標題列。此標題列包含：
            - **左側:** 區塊標題文字（例如：「支出」、「收入」）。
            - **右側:** 「新增」按鈕（例如：一個 `+` 圖示按鈕）。
        - **順序:** 「支出」區塊應顯示在「收入」區塊之上。
    - **類別列表 (Category List):**
        - **UI:** 在各自的分區標題下，顯示對應的類別列表。
        - **列表內容:**
            - 一個可滾動的列表 (`DraggableFlatList`)。
            - **項目內容 (每筆):**
                - 左側：類別圖示 (`icon`)。
                - 中間：類別名稱 (`name`)。
                - 右側：拖拉排序的圖示 (Drag Handle)。
                - **視覺標示 (停用):** 若類別的 `disabledOn` 欄位有值（非 `null`），該項目應以視覺上可區分的方式顯示（例如：文字變為灰色、加上「已停用」標籤）。使用者仍應可以點擊此項目進入編輯器（以便重新啟用）。
            - **空狀態 (Empty State):** 如果該分區沒有任何類別，則在該分區顯示提示文字，例如「您尚未建立任何支出類別」。

## 核心邏輯

- **資料載入邏輯:**
    - 畫面載入時，從「**本機資料庫 (Local DB)**」讀取所有 `Categories` (其中 `deletedOn` 為 `null`)。
    - 查詢結果應包含 `disabledOn` 狀態，以便 UI 進行視覺標示。
    - 根據 `categoryType` (0: 收入, 1: 支出) 將類別分別篩選至兩個不同的陣列中，並根據 `sortOrder` 欄位進行初始排序。

- **互動邏輯:**
    - **點擊列表項目:** 導航至類別編輯器畫面 (`CategoryEditorScreen`) 的「編輯」模式，並傳入該類別的 `categoryId`。
    - **拖拉排序:**
        - 使用者可以長按並拖拉列表中的項目來重新排序（僅限在各自區塊內）。
        - 拖拉結束後，App 必須更新受影響類別的 `sortOrder` 欄位，並將變動寫入「**本機資料庫 (Local DB)**」（**必須**同時更新所有受影響類別的 `updatedOn` 時間戳記，以觸發「批次同步規格」的同步）。
    - **點擊「新增」按鈕:**
        - 點擊「支出」區塊標題旁的「新增」按鈕後，導航至類別編輯器畫面 (`CategoryEditorScreen`) 的「新增」模式，並傳入 `categoryType` 為「支出」。
        - 點擊「收入」區塊標題旁的「新增」按鈕後，導航至類別編輯器畫面 (`CategoryEditorScreen`) 的「新增」模式，並傳入 `categoryType` 為「收入」。

- **付費牆檢查 (Paywall Check):**
    - 在點擊任一「新增」按鈕並導航之前，應先檢查「**本機狀態 (e.g., PremiumContext)**」中的 `isPremiumUser` 狀態以及目前自訂類別的總數 (不含已刪除)。
    - 如果使用者是免費版且類別數量已達上限 (10個，含預設)，則應直接導航至付費牆畫面 (`PaywallScreen`)，而非類別編輯器畫面 (`CategoryEditorScreen`)。

## 狀態管理 (State Management)

- 使用 `useState` 管理從「**本機資料庫**」讀取並分組的類別列表：
    - `expenseCategories: Category[]`
    - `incomeCategories: Category[]`

## 導航 (Navigation)

- **進入:** 從設定主頁 (`SettingsScreen`) 的「類別管理」項目點擊進入。
- **退出:** 點擊頂部導航列的「返回」按鈕。
- **導出:**
    - 點擊列表項目或任一「新增」按鈕，導航至類別編輯器畫面 (`CategoryEditorScreen`)。
    - (可能) 點擊「新增」按鈕時，若觸發付費牆，則導航至付費牆畫面 (`PaywallScreen`)。